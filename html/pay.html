<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-param" content="_csrf-frontend">
    <meta name="csrf-token" content="9KbQKGBaz3NrMQ3liXwYWk6WkgEf5raA6c-6coqnME3PMcFVP092_qbGqN2tYGypDTzSB-2Zhr074Le4DZpLng==">
    <link rel='icon' href='../img/icon.png' type='image/x-ico' />
    <link rel="stylesheet" href="../css/jquery-accordion-menu.css?version=2.9.10">
    <link rel="stylesheet" href="../css/bootstrap.css?version=2.9.10">
    <link rel="stylesheet" href="../css/pay.css?version=2.9.10">
    <link rel="stylesheet" href="../css/base.css?version=2.9.10">
    <title>Trung tâm thanh toán</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-112306571-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-112306571-1');gtag('config', 'AW-856942675');
    </script>
    <script src="../js/jquery2.2.4.min.js?version=2.9.10"></script>
    <script src="../js/jquery-accordion-menu.js?version=2.9.10" type="text/javascript"></script>
    <script src="../js/bootstrap.js?version=2.9.10"></script>
    <script src="../js/md5.js?version=2.9.10"></script>
    <script src="../js/require2.3.5.min.js?version=2.9.10"></script>
    <style>
        .body {
            border-top: 1px solid #72aef0;
        }

        .content1 {
            width: 1200px;
            margin: 0 auto;
            overflow: hidden;
        }

        .left {
            float: left;
        }

        #three {
            margin-bottom: 50px;
        }

        #four {
            line-height: 1;
        }

        /*tcy -start-*/

        .modal-body th {
            line-height: 2;
        }

        .modal-body td {
            line-height: 1.8;
        }

        img,
        span,
        i,
        s {
            display: inline-block;
            /*vertical-align: middle;*/
        }

        .modal-body {
            position: relative;
        }

        .phone-flag {
            position: absolute;
            top: 90px;
            right: 100px;
            line-height: 45px;
        }

        .phone-flag-img {
            width: 30px !important;
            height: 20px !important;
            vertical-align: middle !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            background-size: cover !important;
            background-image: url(../img/VN.png) !important;
        }

        .phone-flag-code {
            color: #333 !important;
            width: auto !important;
        }

        .fenqiNumBtn button.actives {
            background: #eee !important;
            border: 1px solid #eee !important;
            color: #333 !important;
        }

        /*tcy -end-*/

        .body__main {
            padding-top: 30px;
        }

        .body__main-login {
            text-align: center;
            padding-top: 50px;
            background-color: #dfeffc;
        }

        .body__m-l-row1 {
            color: #FF3B57;
            margin-bottom: 45px;
        }

        .body__m-l-r2-button {
            height: 50px;
            line-height: 50px;
            width: 340px;
            text-align: center;
            color: #fff;
            background-color: #207def;
            margin-bottom: 50px;
            cursor: pointer;
            border-radius: 3px;
        }

        .body__m-l-r2-button:hover {
            background-color: #105dcf;
        }

        #myModal123 .modal-body select {
            font-size: 14px;
            width: 270px;
            height: 40px;
            line-height: 40px;
            padding: 0 10px;
            outline: none;
            color: #333;
            margin-right: 1px;
            height: 33px;
            border: 1px solid #ddd;
            margin-left: 10px;
            border-radius: 3px;
            margin-bottom: 24px;
            background-color: #fff;
        }

        .four__wrap {
            height: 188px;
            overflow-y: hidden;
        }

        .four__wrap:after {
            display: block;
            content: "";
            clear: both;
            height: 0;
        }

        .four__wrap_more {
            height: 350px;
            overflow-y: auto;
            margin-bottom: 30px;
        }

        .four__item {
            float: left;
            width: 272px;
            margin-right: 28px;
            padding-top: 10px;
        }

        .four__item-top {
            position: relative;
            padding-top: 25px;
            padding-bottom: 25px;
            padding-left: 30px;
            padding-right: 30px;
            height: 112px;
            margin-bottom: 5px;
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover;
            background-image: url(../img/couponfault1.png);
        }

        .four__item-top:hover {
            cursor: pointer;
            box-shadow: 5px 5px 15px 0px rgba(20, 122, 243, .3);
        }

        .four__i-t-price {
            font-size: 27px;
            color: #fff;
            margin-bottom: 20px;
        }

        .four__i-t-time {
            font-size: 18px;
            color: rgba(255, 255, 255, .7);
        }

        .four__i-t-arrow {
            position: absolute;
            bottom: 0;
            right: 0;
            height: 20px;
            width: 20px;
            background-repeat: no-repeat;
            background-position: bottom right;
            background-size: cover;
            background-image: url(../img/coupon-selected.png);
        }

        .four__item-bottom {
            line-height: 1.4;
            color: #ccc;
            width: 272px;
            height: 39px;
            display: -webkit-box;
            overflow: hidden;
            text-overflow: ellipsis;
            word-wrap: break-word;
            white-space: normal;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            display: none;
        }

        .four__more {
            float: left;
            width: 100%;
            height: 40px;
            line-height: 40px;
            text-align: center;
            color: #999;
            background-color: #f5f5f5;
            margin-bottom: 20px;
            cursor: pointer;
        }

        .four__more-icon {
            padding-top: 15px;
            width: 12px;
            margin-left: 3px;
        }

        .four__nodata {
            height: 100px;
            line-height: 100px;
            text-align: center;
            background-color: #f5f5f5;
            color: #999;
        }

        .four__money {
            font-size: 20px;
            margin-bottom: 30px;
        }

        .four__money-text {
            color: #999;
        }

        .four__money-price {
            color: #FD5147;
        }

        .four__item_disable .four__item-top {
            cursor: not-allowed;
            background-image: url(../img/couponfault2.png);
        }

        .four__item_disable .four__item-top:hover {
            box-shadow: none;
        }
    </style>
</head>

<body>
    <div id="myModal123-label" data-toggle="modal" data-target="#myModal123" style="opacity: 0;"></div>
    <div class="content" id="vue-el">
        <header class="header" id="header"></header>
        <div class="body">
            <section class="site" id="one">
                <div style="height: 30px;"></div>
                <div class="site__title col-xs-24">Xác nhận địa chỉ nhận hàng</div>
                <div class="site__main col-xs-24">
                    <li class="site__main-item" :class="{ 'site__main-item_def': item.isdefault === 'Y', 'site__main-item_active': addrlistData_index === index }"
                        @click="set_active(index, item.msisdn, item, item.username, item.id)" v-for="(item,index) in addrlistData">
                        <div class="site__m-i-row1 col-xs-24">
                            <div class="site__m-i-r1-name js_username col-xs-24" v-html="item.username"></div>
                            <div class="site__m-i-r1-tel js_msisdn col-xs-24" v-html="item.msisdn"></div>
                        </div>
                        <div class="site__m-i-row2 col-xs-24" v-html="item.address + (item.division4thName ? ', ' : '') + item.division4thName + (item.division3rdName ? ', ' : '') + item.division3rdName + (item.division2ndName ? ', ' : '') + item.division2ndName"></div>
                        <div class="site__m-i-row3 col-xs-24">
                            <div class="site__m-i-r3-def">
                                <span class="site__m-i-r3-f-set moren" @click.stop="moren(index,item.id,item.isdefault,item.msisdn,item.address,item.username,item.division4th,item.division3rd,item.division2nd)">Đặt làm mặc định</span>
                                <span class="site__m-i-r3-f-status">mặc định</span>
                            </div>
                            <div class="site__m-i-r3-edit" @click.stop="add_edit_address({id:item.id,isdefault:item.isdefault,msisdn:item.msisdn,address:item.address,username:item.username,division3rd:item.division3rd,division2nd:item.division2nd,division4th:item.division4th,model:'modify'})">
                                <span class="site__m-i-r3-e-text">Sửa</span>
                            </div>
                            <div class="site__m-i-r3-del">
                                <span class="site__m-i-r3-d-text" @click.stop="remove(item.id)">Xoá</span>
                            </div>
                        </div>
                        <div class="site__m-i-row4">√</div>
                    </li>
                    <div class="site__main-add" @click="addppp()">
                        <div class="site__m-a-row1"></div>
                        <div class="site__m-a-row2">Thêm địa chỉ nhận hàng</div>
                    </div>
                </div>
            </section>
            <section id="two">
                <div class="content1">
                    <div class="two">
                        <div class="top_title">
                            <i></i>
                            <span>Xác nhận thông tin đặt hàng</span>
                        </div>
                        <div class="information">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Thông tin về sản phẩm
                                            <div class="bg"></div>
                                        </th>
                                        <th>Số lượng
                                            <div class="bg"></div>
                                        </th>
                                        <th>Giá sản phẩm
                                            <div class="bg"></div>
                                        </th>
                                        <th>Tổng số phụ
                                            <div class="bg"></div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(item,index) in LS__data" class="ls-data-css">
                                        <td>
                                            <img alt="image" style="width: 85px; cursor: pointer;" :src="item.iconUrl" @click="gotoDetails(item._detail.typeId, item._detail.brandId, item._detail.id)">
                                            <span v-html="item.subject" style="margin-top: 30px; width: 590px;"></span>
                                        </td>
                                        <td id="buyNum" v-html="item.quantity"></td>
                                        <td id="price" v-html="priceFormat(item.totalAmount)"></td>
                                        <td v-html="priceFormat(item.totalAmount*item.quantity)"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="list">
                                <div class="left li-left">Chọn tỉ lệ thanh toán lần đầu : </div>
                                <div class="left li-right">
                                    <select v-model="paymentNum">
                                        <option value="1.0" class="selectoption0">Trả toàn bộ</option>
                                        <option value="0.1" class="selectoption1">10%</option>
                                        <option value="0.2" class="selectoption2">20%</option>
                                        <option value="0.3" class="selectoption3">30%</option>
                                        <option value="0.4" class="selectoption4">40%</option>
                                        <option value="0.5" class="selectoption5">50%</option>
                                    </select>
                                    <span style="line-height: 25px;">Thanh toán lần đầu
                                        <i v-html="priceFormat((totalamount-savePrice)*parseFloat(paymentNum))"></i> VND</span>
                                </div>
                            </div>
                            <div class="list">
                                <div class="left li-left">Chọn số kỳ thanh toán : </div>
                                <div class="left li-right fenqiNumBtn">
                                    <button id="fenqiNum3" :class="{ 'b_active': fenqiNum === 3 }" @click="fenqiNum = 3">3 tháng</button>
                                    <button id="fenqiNum6" :class="{ 'b_active': fenqiNum === 6 }" @click="fenqiNum = 6">6 tháng</button>
                                    <button id="fenqiNum9" :class="{ 'b_active': fenqiNum === 9 }" @click="fenqiNum = 9">9 tháng</button>
                                    <button id="fenqiNum12" :class="{ 'b_active': fenqiNum === 12 }" @click="fenqiNum = 12">12 tháng</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <article id="four">
                <div class="content1">
                    <div class="four fullpay_mark">
                        <div class="top_title">
                            <i></i>
                            <span>Mã giảm giá</span>
                        </div>
                    </div>
                    <div class="way" style="padding-left: 0;">
                        <div class="four__wrap" style="display: none;" :class="{ 'four__wrap_more': LS__coupon.length > 4 }" v-show="LS__coupon.length > 0">
                            <item class="four__item" v-for="(val, key) in LS__coupon" @click="couponSelect(key, val.id, val.pids, val.status, val.voucherType, val.voucherValue)"
                                :class="{ 'four__item_disable': val.status === 0 || !val.canUse, 'four__item_selected': val.isSelected }">
                                <div class="four__item-top">
                                    <div class="four__i-t-price" v-html="val.voucherValue +' VND'" v-if="val.voucherType === 1"></div>
                                    <div class="four__i-t-price" v-html="'Giảm '+(100-val.voucherValue)+'%'" v-if="val.voucherType === 0"></div>
                                    <div class="four__i-t-time" v-html="time_format(val.startTime, val.expireTime)"></div>
                                    <div class="four__i-t-arrow" v-show="val.isSelected"></div>
                                </div>
                                <div class="four__item-bottom" v-if="val.status === 0" v-html="val.voucherDesc"></div>
                            </item>
                        </div>
                        <!-- <div class="four__more">
                                <span>查看更多</span>
                                <img src="../img/couponmore.png" alt="more" class="four__more-icon">
                            </div> -->
                        <div class="four__nodata" style="display: none;" v-show="LS__coupon.length === 0">Tạm thời chưa thể nhận Voucher</div>
                        <!-- <div class="four__money" style="display: none;" v-show="LS__coupon.length > 0">
                            <span class="four__money-text">Tiết kiệm</span>
                            <span class="four__money-price" v-html="priceFormat(savePrice) + ' VND'"></span>
                        </div> -->
                    </div>
                </div>
            </article>
            <article id="three">
                <div class="content1">
                    <section class="orderinfo">
                        <div class="orderinfo__main">
                            <div class="orderinfo__main-row1" v-show="paymentNum !== '1.0'">
                                <div class="orderinfo__m-r1-item1">
                                    <span class="orderinfo__m-r1-i1-text">Số kỳ thanh toán:</span>
                                    <span class="orderinfo__m-r1-i1-price" v-html="fenqiNum + ' Tháng'"></span>
                                </div>
                                <div class="orderinfo__m-r1-item2">
                                    <span class="orderinfo__m-r1-i2-text">Tỉ lệ thanh toán lần đầu:</span>
                                    <span class="orderinfo__m-r1-i2-price" v-html="paymentNum*100 + '%'"></span>
                                </div>
                                <div class="orderinfo__m-r1-item3">
                                    <span class="orderinfo__m-r1-i3-text">Trả góp hàng tháng:</span>
                                    <span class="orderinfo__m-r1-i3-price" v-html="priceFormat(resPrice) + ' VND x ' + fenqiNum"></span>
                                    <img src="../img/alert-prepaid.svg" alt="" style="width:15px;height:15px;cursor: pointer; margin-top: 17px;" data-toggle="modal"
                                        data-target="#myhead" class="moneryIcon" />
                                </div>
                            </div>
                            <div class="orderinfo__main-row2">
                                <div class="orderinfo__main-r2-title">Giá trị sản phẩm:</div>
                                <div class="orderinfo__main-r2-price" v-html="priceFormat(F.totalamount) + ' VND'"></div>
                                <div class="orderinfo__main-r2-title">Tiết kiệm:</div>
                                <div class="orderinfo__main-r2-price" v-html="priceFormat(savePrice) + ' VND'"></div>
                                <div class="orderinfo__main-r2-title">Số tiền cần thanh toán:</div>
                                <div class="orderinfo__main-r2-redprice" v-html="priceFormat((totalamount-savePrice)*parseFloat(paymentNum)) + ' VND'"></div>
                            </div>
                        </div>
                    </section>
                    <div class="three fullpay_mark" style="display: none;" v-show="paymentNum === '1.0'">
                        <div class="top_title">
                            <i></i>
                            <span>Phương thức thanh toán</span>
                        </div>
                    </div>
                    <div class="way">
                        <div class="payway__main-bottom" style="display: none;" v-show="paymentNum === '1.0'">
                            <!-- <div class="payway__m-b-item" @click="payway = '3'" :class="{ 'payway__m-b-item_acitve': payway === '3' }">
                                    <div class="payway__m-b-i-text">napas</div>
                                    <div class="payway__m-b-i-icon">
                                        <span class="payway__m-b-i-icon-img" style="background-image: url(../img/pay_napas.png);"></span>
                                    </div>
                                    <div class="payway__m-b-i-indicator">
                                        <span class="payway__m-b-i-i-img"></span>
                                    </div>
                                </div> -->
                            <div class="payway__m-b-item" @click="payway = '2'" :class="{ 'payway__m-b-item_acitve': payway === '2' }">
                                <div class="payway__m-b-i-text">Ngân hàng</div>
                                <div class="payway__m-b-i-icon">
                                    <span class="payway__m-b-i-icon-img" style="background-image: url(../img/pay_epay.png);"></span>
                                </div>
                                <div class="payway__m-b-i-indicator">
                                    <span class="payway__m-b-i-i-img"></span>
                                </div>
                            </div>
                            <div class="payway__m-b-item" @click="payway = '1'" :class="{ 'payway__m-b-item_acitve': payway === '1' }">
                                <div class="payway__m-b-i-text">Số dư</div>
                                <div class="payway__m-b-i-icon">
                                    <span class="payway__m-b-i-icon-img" style="background-image: url(../img/pay_balance.png);"></span>
                                </div>
                                <div class="payway__m-b-i-indicator">
                                    <span class="payway__m-b-i-i-img"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="fc" style="vertical-align: right; margin-top: 0;">
                        <!-- <p v-show="paymentNum === '1.0'" style="text-align: right; padding-right: 10px; line-height: 40px; display: none;">
                                <span style="padding-top: 2px; padding-right:5px;">Tổng tiền:</span>
                                <i v-html="priceFormat(totalResPrice)"></i>
                                <span class="" style="padding-top: 3px;">VND</span>
                            </p>
                            <p v-show="paymentNum !== '1.0'" style="text-align: right; line-height: 40px; color: #969696; display: none;">
                                Trả góp hàng tháng:
                                <i v-html="priceFormat(resPrice)" style="margin-left: 5px;"></i>
                                <span class="" style="color: #F7004C; padding-top: 2px;">VND x
                                    <span v-html="fenqiNum"></span>
                                </span>
                                <img src="../img/titi.png" alt="" style="width:15px;height:15px;cursor: pointer; margin-top: 12px;" data-toggle="modal" data-target="#myhead"
                                    class="moneryIcon" />
                            </p> -->
                        <div class="" style="text-align: right;">
                            <span class="aa no_checkbox1" @click="submit()">Mua ngay</span>
                        </div>
                        <div class="p" style="text-align: right; opacity: 0;">
                            <input type="checkbox" id="selectAll" />
                            <span>Đồng ý</span>
                            <i href="buyIntro.html" target="_self">Hợp đồng liên quan đến khoản vay</i>
                        </div>
                    </div>

                </div>
            </article>
        </div>
        <!-- 弹出模态框（Modal） -->
        <div class="modal fade" id="myhead" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div style="display: table;width:690px;height:100%;margin:0 auto;">
                <div class="modal-dialog" style="display: table-cell;text-align: center;vertical-align: middle;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <div class="left">Thông tin về số tiền trả góp</div>
                            <div class="right" data-dismiss="modal">
                                <span class="alert__b-m-t-close"></span>
                            </div>
                        </div>
                        <div class="modal-body">
                            <table border="1" class="tables">
                                <thead>
                                    <tr>
                                        <th>Hóa đơn</th>
                                        <th>Số tiền phải trả hàng tháng</th>
                                        <th>Phí dịch vụ hàng tháng</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- /.modal-content -->
                </div>
                <!-- /.modal -->
            </div>
        </div>

        <footer class="footer" id="footer"></footer>
    </div>
    <script>
        require([
            // '../js/jquery1.11.2.js?version=2.9.10',
            '../js/vue.min.js?version=2.9.10',
            '../js/md5.js?version=2.9.10',
            '../js/common.js?version=2.9.10',
            '../js/popup.js?version=2.9.10',
        ], function (Vue, md5) {
            var loading = new F._loading();

            F.query = F._hrefUtils.parse().query || {};
            if (F.query && F.query.from === "cart") {
                F.isToCart = true;
            } else {
                F.isToCart = false;
            }

            F.LS__data = JSON.parse(sessionStorage.getItem("pay_cart_data"));
            F.subject = F.LS__data[0].subject;
            F.goodsDetail = F.LS__data[0].detail;
            F.fenqiNum = F.isToCart ? 12 : +sessionStorage.getItem("fenqiNum");
            F.paymentNum = F.isToCart ? "0.5" : sessionStorage.getItem("paymentNum") + "";

            function calc_allTotalData(array) {
                var i;
                var index;
                var result = {
                    totalAmount: 0,
                    orgPrice: 0
                };
                for (index = 0; index < array.length; index++) {
                    result.totalAmount += array[index].totalAmount * array[index].quantity;
                    result.orgPrice += array[index].orgPrice * array[index].quantity;
                }
                return result;
            }


            var calc_total_price = function (FLS__data, couponProductIdArray) {
                // 优惠总额度
                var discountsPriceTotal = 0;

                // 返回优惠的金额
                var discountsPrice = function (productId, array) {
                    for (let index = 0; index < array.length; index++) {
                        const element = array[index];
                        if (productId === element.productId) {
                            if (element.couponId) {
                                if (element.voucherType === 1) {
                                    // 满减券
                                    return element.voucherValue;
                                } else {
                                    // 折扣券
                                    return element.totalAmount * (100 - element.voucherValue) * 0.01;
                                }
                            } else {
                                return 0;
                            }
                        }
                    }
                }

                for (let index = 0; index < FLS__data.length; index++) {
                    const element = FLS__data[index];
                    discountsPriceTotal += discountsPrice(element._detail.id, couponProductIdArray);
                }
                return discountsPriceTotal;
            }

            var allTotalData_result = calc_allTotalData(F.LS__data);
            F.totalamount = allTotalData_result.totalAmount;
            F.orgPrice = allTotalData_result.orgPrice;

            F.vue = {
                body__main_height: document.documentElement.clientHeight - 133 - 210 - 210,
                LS__data: F.LS__data,
                subject: F.subject,
                goodsDetail: F.goodsDetail,
                fenqiNum: F.fenqiNum,
                paymentNum: '0.1',
                totalamount: F.totalamount,
                orgPrice: F.orgPrice,
                addrlistData: [],
                resPrice: 0, // 分期价格
                totalResPrice: 0, // 未分期
                // 
                LS__coupon: [],
                selected: [],
                coupon_product_id: edit_coupon_product_id(F.LS__data),
                savePrice: 0,
                // 
                payway: '2',
            };

            var load = function () {
                new_vue();
            };

            var pre_data = function (data) {
                var userAddr = data._userViewAddr.details;
                var judgeVoucher = data._judgeVoucher.details;

                function set_couponData(array) {
                    let result = [];
                    for (let index = 0; index < array.length; index++) {
                        let element = array[index];
                        element.canUse = !!element.status;
                        element.isSelected = false;
                        result.push(element);
                    }
                    return result;
                }

                change_money(F.vue.totalamount - F.vue.savePrice, F.vue.fenqiNum, F.vue.paymentNum);

                F.vue.LS__coupon = set_couponData(judgeVoucher);
                for (var i = 0; i < userAddr.length; i++) {
                    if (userAddr[i].isdefault === "Y" && userAddr[i].division2ndName) {
                        // F.address = userAddr[i].address;

                        F.address = userAddr[i].address;
                        F.address_id = userAddr[i].id;
                        F.division4thName = userAddr[i].division4thName;
                        F.division3rdName = userAddr[i].division3rdName;
                        F.division2ndName = userAddr[i].division2ndName;
                        F.division4thCode = userAddr[i].division4thCode;
                        F.division3rdCode = userAddr[i].division3rdCode;
                        F.division2ndCode = userAddr[i].division2ndCode;

                        // F.division2ndName = userAddr[i].division2ndName;
                        // F.address = userAddr[i].address + ", " + userAddr[i].division4thName + ", " + userAddr[i].division3rdName + ", " + userAddr[i].division2ndName;
                        F.msisdn = userAddr[i].msisdn;
                        F.username = userAddr[i].username;
                        F.vue.addrlistData_index = i;
                    }
                }

                F.vue.addrlistData = F.addrlistData = userAddr;
                F.vue.addrlistLength = userAddr.length;

            }

            F.loadData = function (params, callback) {
                if (callback === undefined) callback = params;

                var all_data = {};
                var request_length = 2; //请求个数

                // 请求是否全部返回
                function all_loaded() {
                    if (Object.keys(all_data).length === request_length) {
                        pre_data(all_data);
                        loading.hide();
                        callback(all_data);
                    }
                }
                loading.show();


                if (localStorage.getItem("funId")) {
                    F._userAction_userViewAddr({}, function (ret) {
                        if (!ret) return false;
                        if (ret.code !== 10000) return false;

                        all_data._userViewAddr = ret;
                        all_loaded();
                    });
                } else {
                    all_data._userViewAddr = {
                        "subMsg": "find success",
                        "details": [],
                        "subCode": "10000",
                        "code": 10000,
                        "msg": "success"
                    };
                    all_loaded();
                }

                F._judgeVoucher({
                    funid: localStorage.getItem("funId") || '',
                    products: JSON.stringify(set_products(F.LS__data)),
                }, function (ret) {
                    if (!ret) return false;
                    if (ret.code !== 10000) return false;

                    all_data._judgeVoucher = ret;
                    all_loaded();
                });
            };

            function new_vue() {
                F.vue = new Vue({
                    el: $('#vue-el')[0],
                    data: F.vue,
                    methods: {
                        addppp: addppp,
                        set_active: set_active,
                        remove: remove,
                        moren: moren,
                        couponSelect: couponSelect,
                        time_format: time_format,
                        submit: submit,
                        priceFormat: F._priceFormat,
                        add_edit_address: F._add_edit_address,
                    },
                    computed: {

                    },
                    mounted: function () {
                        this.paymentNum = F.paymentNum;
                        F._downPayment(F.totalamount);
                    },
                    watch: {
                        addrlistLength: function (val, oldVal) {
                            if (val > 4) {
                                $(".addAddrli").css("display", "none");
                            }
                        },
                        paymentNum: function (num, oldVal) {
                            num = num + "";
                            if (num == "1.0") {
                                $('#three .fullpay_mark').show();


                                $(".moneryIcon,.installment").hide();

                                $(".fenqiNumBtn button")
                                    .attr("disabled", true)
                                    .addClass("actives");
                                F.vue.resPrice = F.vue.totalamount;
                            } else {
                                $('#three .fullpay_mark').hide();


                                $(".moneryIcon,.installment").show();

                                $(".fenqiNumBtn button")
                                    .attr("disabled", false)
                                    .removeClass("actives");

                                change_money(F.vue.totalamount - F.vue.savePrice, F.vue.fenqiNum, num);
                            }
                        },
                        fenqiNum: function (val, oldVal) {
                            change_money(F.vue.totalamount - F.vue.savePrice, val, F.vue.paymentNum);
                        },
                        coupon_product_id: function (val, oldVal) {
                            // let total = 0;

                            // function calc_coupon(totalAmount, couponId) {
                            //     let array = F.vue.LS__coupon;
                            //     for (let index = 0; index < array.length; index++) {
                            //         const element = array[index];
                            //         if (couponId === element.id) {
                            //             if (element.voucherType === 0) {
                            //                 // 折扣
                            //                 return totalAmount * ((100 - element.voucherValue) / 100);
                            //             } else {
                            //                 return element.voucherValue;
                            //             }
                            //         }
                            //     }
                            // }

                            // let array = val;
                            // for (let index = 0; index < array.length; index++) {
                            //     const element = array[index];
                            //     if (element.couponId !== '') total += calc_coupon(element.totalAmount, element.couponId);
                            // }
                            this.savePrice = calc_total_price(F.LS__data, this.coupon_product_id);
                            // this.savePrice = +total;

                            // console.log(calc_total_price(F.LS__data, this.coupon_product_id));

                            change_money(F.vue.totalamount - F.vue.savePrice, F.vue.fenqiNum, F.vue.paymentNum);
                        },
                    },
                });
            }

            var addppp = function (params) {
                if (!localStorage.getItem("funId")) {
                    F._confirm("Gợi ý", "Vui lòng đăng nhập", "tips", [
                        {
                            name: "Xác nhận",
                            func: function () {
                                window.location.href = "login.html";
                            }
                        }
                    ]);
                    return false;
                }

                F._add_edit_address({
                    id: "",
                    isdefault: "",
                    msisdn: "",
                    address: "",
                    username: "",
                    districts_id: "",
                    provinces_id: "",
                    wards_id: ""
                });
            };


            var set_active = function (index, msisdn, item, username, id) {
                F.address_id = id;
                F.address = item.address;
                F.division4thName = item.division4thName;
                F.division3rdName = item.division3rdName;
                F.division2ndName = item.division2ndName;
                F.division4thCode = item.division4thCode;
                F.division3rdCode = item.division3rdCode;
                F.division2ndCode = item.division2ndCode;

                F.msisdn = msisdn;
                F.username = username;

                $(".site__main-item").removeClass("site__main-item_active");
                $(".site__main-item")
                    .eq(index)
                    .addClass("site__main-item_active");
            };

            //  删除地址
            var remove = function ($id) {
                event.stopPropagation();
                if (confirm("Xác nhận xóa địa chỉ?")) {
                    var loading = new F._loading();
                    loading.show();
                    F._userAction_userDelAddrs(
                        {
                            adds: $id
                        },
                        function (ret) {
                            loading.hide();
                            if (!ret) return false;
                            if (ret.code !== 10000) return false;
                            window.location.reload();
                        }
                    );
                }
            };

            //	默认地址
            var moren = function (index, $id, $isdefault, $msisdn, $address, $username, division4th, division3rd, division2nd) {
                if (!F._isLogin()) return false;

                if (!division2nd) {
                    F._confirm("Gợi ý", "Địa chỉ này chưa đầy đủ", "tips", [
                        {
                            name: "Sửa",
                            func: function () {
                                $(".site__m-i-r3-edit")
                                    .eq(index)
                                    .click();
                            }
                        }
                    ]);
                    return false;
                }

                if (confirm("Xác nhận cài đặt địa chỉ nhận hàng mặc định？")) {
                    var loading = new F._loading();
                    loading.show();
                    F._userAction_userModifyAddr(
                        {
                            addrid: $id,
                            msisdn: $msisdn,
                            address: $address,
                            isdefault: "Y",
                            username: $username,
                            division2nd: division2nd,
                            division3rd: division3rd,
                            division4th: division4th
                        },
                        function (ret) {
                            loading.hide();
                            if (!ret) return false;
                            if (ret.code !== 10000) return false;

                            window.location.reload();
                        }
                    );
                }
            };

            var set_products = function (array) {
                let result = [];
                for (let index = 0; index < array.length; index++) {
                    const element = array[index];
                    let empty_object = {};
                    empty_object.id = element._detail.id;
                    empty_object.amount = element.totalAmount * element.quantity;
                    result.push(empty_object);
                }
                return result;
            }

            var couponSelect = function (key, id, pids, status, voucherType, voucherValue) {
                if (status === 0) return false;

                // 一个订单可以使用多张优惠券
                function A(key, id, pids) {
                    pids = JSON.parse(pids);

                    function isCanSelect(pid) {
                        let array = F.vue.coupon_product_id;
                        for (let index = 0; index < array.length; index++) {
                            let element = array[index];
                            if (element.productId === pid && element.couponId === id) {
                                // 取消选择
                                let item1 = element;
                                item1.couponId = '';
                                array.splice(index, item1);

                                let item = F.vue.LS__coupon[key];
                                item.isSelected = false;
                                F.vue.LS__coupon.splice(key, item);
                                return true;
                            } else if (element.productId === pid && element.couponId === "") {
                                // 选择
                                let item1 = element;
                                item1.couponId = id;
                                array.splice(index, item1);


                                let item = F.vue.LS__coupon[key];
                                item.isSelected = true;
                                F.vue.LS__coupon.splice(key, item);
                                return true;
                            }
                        }
                    }

                    function iscanUse(vue_LS__coupon) {

                        function judge(array) {
                            let emptyLength = 0;
                            let array1 = F.vue.coupon_product_id;

                            for (let index = 0; index < array.length; index++) {
                                const pid = array[index];
                                for (let index1 = 0; index1 < array1.length; index1++) {
                                    const element = array1[index1];
                                    if (pid === element.productId) {
                                        if (element.couponId !== '') {
                                            emptyLength += 1;
                                        }
                                    }
                                }
                            }
                            // 如果相等说明和已选的券重复了
                            return emptyLength === array.length;
                        }

                        for (let index = 0; index < vue_LS__coupon.length; index++) {
                            const element = vue_LS__coupon[index];
                            if (element.status === 1 && element.isSelected === false) {
                                if (judge(JSON.parse(element.pids))) {
                                    // 和已选的券重复了
                                    let item = F.vue.LS__coupon[index];
                                    item.canUse = false;
                                    F.vue.LS__coupon.splice(index, item);

                                } else {
                                    let item = F.vue.LS__coupon[index];
                                    item.canUse = true;
                                    F.vue.LS__coupon.splice(index, item);
                                }
                            }
                        }
                    }

                    for (let index = 0; index < pids.length; index++) {
                        const element = pids[index];
                        if (isCanSelect(element)) {
                            break;
                        }
                    }
                    iscanUse(F.vue.LS__coupon);
                }

                // 一个订单只能使用一张优惠券
                function B(key, id, pids) {
                    pids = JSON.parse(pids); // 可以使用此优惠券的商品id集合
                    var useCouponProductIdIndex = []

                    function cancelUnuseCouponProductId(useCouponProductIdIndex) {
                        var array = F.vue.coupon_product_id;
                        for (let index = 0; index < array.length; index++) {
                            const element = array[index];

                            if (useCouponProductIdIndex.indexOf(index) === -1) {
                                // 未在其中，未被使用

                                var item1 = element;
                                item1.couponId = '';
                                item1.voucherType = null;
                                item1.voucherValue = null;
                                array.splice(index, 1, item1);
                            }
                        }
                    }

                    function isCanSelectProduct(productId) {
                        var array = F.vue.coupon_product_id;
                        for (let index = 0; index < array.length; index++) {
                            const element = array[index];
                            if (element.productId === productId) {
                                // 可以使用此优惠券
                                let item1 = element;
                                item1.couponId = id;
                                item1.voucherType = voucherType;
                                item1.voucherValue = voucherValue;
                                array.splice(index, 1, item1);

                                useCouponProductIdIndex.push(index);
                            } else {
                                // 不可以使用此优惠券
                            }
                        }
                    }

                    function for_pids(array) {
                        for (let index = 0; index < array.length; index++) {
                            const element = array[index];
                            isCanSelectProduct(element);
                            // 一个订单满减券只能用于一个商品
                            if (voucherType === 1) break;
                        }
                        cancelUnuseCouponProductId(useCouponProductIdIndex);
                    }

                    var array = F.vue.LS__coupon;
                    for (let index = 0; index < array.length; index++) {
                        const element = array[index];
                        if (index === key) {
                            // 选择

                            for_pids(pids);

                            let item = F.vue.LS__coupon[index];
                            item.isSelected = true;
                            F.vue.LS__coupon.splice(index, 1, item);
                        } else {
                            // 不选择

                            let item = F.vue.LS__coupon[index];
                            item.isSelected = false;
                            F.vue.LS__coupon.splice(index, 1, item);
                        }
                    }
                }

                // 一个订单只能使用一张优惠券
                function B1(key, id, pids) {
                    pids = JSON.parse(pids);


                    // 是否已选择了优惠券
                    function isSelected(array) {
                        for (let index = 0; index < array.length; index++) {
                            const element = array[index];
                            if (element.couponId !== '') return true;
                        }
                        return false;
                    }


                    function isCanSelect(pid) {
                        let array = F.vue.coupon_product_id;
                        for (let index = 0; index < array.length; index++) {
                            let element = array[index];
                            if (element.productId === pid && element.couponId === id) {
                                // 取消选择
                                let item1 = element;
                                item1.couponId = '';
                                item1.voucherType = null;
                                item1.voucherValue = null;
                                array.splice(index, item1);

                                let item = F.vue.LS__coupon[key];
                                item.isSelected = false;
                                F.vue.LS__coupon.splice(key, item);
                                return true;
                            } else if (element.productId === pid && element.couponId === "" && !isSelected(F.vue.coupon_product_id)) {

                                // 选择
                                let item1 = element;
                                item1.couponId = id;
                                item1.voucherType = voucherType;
                                item1.voucherValue = voucherValue;
                                array.splice(index, item1);


                                let item = F.vue.LS__coupon[key];
                                item.isSelected = true;
                                F.vue.LS__coupon.splice(key, item);
                                return true;
                            }
                        }
                    }

                    function iscanUse(vue_LS__coupon) {

                        function judge(array) {
                            let emptyLength = 0;
                            let array1 = F.vue.coupon_product_id;

                            for (let index = 0; index < array.length; index++) {
                                const pid = array[index];
                                for (let index1 = 0; index1 < array1.length; index1++) {
                                    const element = array1[index1];
                                    if (pid === element.productId) {
                                        if (element.couponId !== '') {
                                            emptyLength += 1;
                                        }
                                    }
                                }
                            }
                            // 如果相等说明和已选的券重复了
                            return emptyLength === array.length;
                        }

                        for (let index = 0; index < vue_LS__coupon.length; index++) {
                            const element = vue_LS__coupon[index];
                            if (element.status === 1 && element.isSelected === false) {
                                if (isSelected(F.vue.coupon_product_id)) {
                                    let item = F.vue.LS__coupon[index];
                                    item.canUse = false;
                                    F.vue.LS__coupon.splice(index, item);
                                } else {
                                    let item = F.vue.LS__coupon[index];
                                    item.canUse = true;
                                    F.vue.LS__coupon.splice(index, item);
                                }

                                // if (judge(JSON.parse(element.pids))) {
                                //     // 和已选的券重复了
                                //     let item = F.vue.LS__coupon[index];
                                //     item.canUse = false;
                                //     F.vue.LS__coupon.splice(index, item);

                                // } else {
                                //     let item = F.vue.LS__coupon[index];
                                //     item.canUse = true;
                                //     F.vue.LS__coupon.splice(index, item);
                                // }
                            }
                        }
                    }

                    function cancel_all() {
                        let array = F.vue.coupon_product_id;
                        for (let index = 0; index < array.length; index++) {
                            let element = array[index];
                            // 取消选择
                            let item1 = element;
                            item1.couponId = '';
                            item1.voucherType = null;
                            item1.voucherValue = null;
                            array.splice(index, item1);
                        }


                        let array1 = F.vue.LS__coupon;
                        for (let index1 = 0; index1 < array1.length; index1++) {
                            let item = F.vue.LS__coupon[index1];
                            item.isSelected = false;
                            F.vue.LS__coupon.splice(index1, item);
                        }
                    }
                    cancel_all();

                    for (let index = 0; index < pids.length; index++) {
                        const element = pids[index];
                        if (isCanSelect(element)) {
                            break;
                        }
                    }
                    // iscanUse(F.vue.LS__coupon);
                }

                B(key, id, pids);
            }

            function time_format(start, end) {
                var start_format = start.slice(0, 4) + '.' + start.slice(5, 7) + '.' + start.slice(8, 10);
                var end_format = end.slice(0, 4) + '.' + end.slice(5, 7) + '.' + end.slice(8, 10);
                return start_format + '-' + end_format;
            }

            function edit_coupon_product_id(array) {
                let result = [];
                for (let index = 0; index < array.length; index++) {
                    const element = array[index];
                    let emptyObject = {};
                    emptyObject.productId = element._detail.id;
                    emptyObject.couponId = '';
                    emptyObject.voucherType = null;
                    emptyObject.voucherValue = null;
                    emptyObject.totalAmount = element.totalAmount * element.quantity;
                    result.push(emptyObject);
                }
                return result;
            }

            function change_money(totalamounts, repaymentmonths, payrate) {

                var information = function (details) {
                    $(".tables tbody").html("");
                    for (i = 1; i < details[detailsArrayString].length + 1; i++) {
                        $(".tables tbody").append("<tr><td>" + i + " Số kỳ</td><td>" + F._priceFormat(details[detailsArrayString][i - 1].principal) + " VND</td><td>" + F._priceFormat(details[detailsArrayString][i - 1].interest) + " VND</td></tr>");
                    }
                };

                var detailsArrayString = totalamounts + "_" + repaymentmonths + "_" + payrate;

                F.vue.totalResPrice = totalamounts;

                F._returnMoney({
                    totalamounts: totalamounts,
                    repaymentmonths: repaymentmonths,
                    payrate: payrate,
                }, function (ret) {
                    if (!ret) return false;
                    if (ret.code !== 10000) return false;
                    var details = ret.details;
                    F.vue.resPrice = details[detailsArrayString][0].interest + details[detailsArrayString][0].principal;
                    information(details);
                });

            }

            function analyze_orderdetails(array) {
                var index;
                var result = {
                    totalAmount: 0,
                    orgAmount: 0,
                    advance: 0,
                    goodsDetail: [],
                    subject: '',
                };
                var result_ids = [];

                function edit_detail(item) {
                    var result = {};
                    result.number = item.quantity;
                    result.cartitemid = item.id + '';
                    result.productInfoId = item.itemId;
                    return result;
                }

                for (index = 0; index < array.length; index++) {
                    result.totalAmount += array[index].totalAmount * array[index].quantity;
                    result.orgAmount += array[index].orgPrice ? array[index].orgPrice * array[index].quantity : 0;
                    result.advance += array[index].totalAmount * array[index].quantity * parseFloat(F.vue.paymentNum);
                    result.subject += array[index].subject + ', ';
                    result.goodsDetail.push(edit_detail(array[index]));

                    // result_ids.push(array[index].id);
                }
                result.subject = result.subject.slice(0, -2);
                // F.result_ids = result_ids.join(',');


                return result;
            }

            function go_next() {
                var coupon_item = get_coupon_item(get_coupon_id(F.vue.coupon_product_id), F.vue.LS__coupon);

                if (F.isToCart) {
                    loading.show();
                    var analyze_orderdetails_result = analyze_orderdetails(F.LS__data);
                    F._createDisOrder({
                        orderdetails: [{
                            payRate: F.vue.paymentNum === '1.0' ? F.vue.paymentNum.slice(0, 1) : F.vue.paymentNum,
                            orderNo: F._create_orderno(localStorage.getItem("funId")),
                            totalAmount: analyze_orderdetails_result.totalAmount,
                            orgAmount: analyze_orderdetails_result.orgAmount,
                            advance: analyze_orderdetails_result.advance,
                            currency: 'VND',
                            subject: analyze_orderdetails_result.subject,
                            goodsDetail: JSON.stringify(analyze_orderdetails_result.goodsDetail),
                            repaymentMonth: F.vue.paymentNum === '1.0' ? 0 : F.vue.fenqiNum,
                            couponCard: coupon_item.cardno || '',
                            couponPassword: coupon_item.pincode || '',
                            couponType: coupon_item.voucherType || 0,
                            couponValue: coupon_item.voucherValue || 0,
                            couponBrandId: coupon_item.brandId || 0,
                            couponTypeId: coupon_item.typeId || 0,
                            couponProductInfoId: coupon_item.productId || 0,
                        }],
                        ordertype: F.vue.paymentNum === '1.0' ? "3" : "4",
                        addrid: F.address_id,
                    }, createDisOrder_callback);

                } else if (F.vue.paymentNum === '1.0') { // 全款

                    loading.show();
                    F._createDisOrder({
                        orderdetails: [{
                            payRate: F.vue.paymentNum.slice(0, 1),
                            orderNo: F._create_orderno(localStorage.getItem("funId")),
                            totalAmount: F.totalamount,
                            orgAmount: F.orgPrice,
                            advance: F.totalamount,
                            currency: 'VND',
                            subject: F.subject,
                            goodsDetail: JSON.stringify([{
                                number: F.quantity,
                                cartitemid: '',
                                productInfoId: JSON.parse(F.goodsDetail)['id']
                            }]),
                            repaymentMonth: 0,
                            couponCard: coupon_item.cardno || '',
                            couponPassword: coupon_item.pincode || '',
                            couponType: coupon_item.voucherType || 0,
                            couponValue: coupon_item.voucherValue || 0,
                            couponBrandId: coupon_item.brandId || 0,
                            couponTypeId: coupon_item.typeId || 0,
                            couponProductInfoId: coupon_item.productId || 0,
                        }],
                        ordertype: "2",
                        addrid: F.address_id,
                    }, createDisOrder_callback);

                } else {

                    loading.show();
                    F._createDisOrder({
                        orderdetails: [{
                            payRate: F.vue.paymentNum,
                            orderNo: F._create_orderno(localStorage.getItem("funId")),
                            totalAmount: F.totalamount,
                            orgAmount: F.orgPrice,
                            advance: F.totalamount * parseFloat(F.vue.paymentNum),
                            currency: 'VND',
                            subject: F.subject,
                            goodsDetail: JSON.stringify([{
                                number: F.quantity,
                                cartitemid: '',
                                productInfoId: JSON.parse(F.goodsDetail)['id']
                            }]),
                            repaymentMonth: F.vue.fenqiNum,
                            couponCard: coupon_item.cardno || '',
                            couponPassword: coupon_item.pincode || '',
                            couponType: coupon_item.voucherType || 0,
                            couponValue: coupon_item.voucherValue || 0,
                            couponBrandId: coupon_item.brandId || 0,
                            couponTypeId: coupon_item.typeId || 0,
                            couponProductInfoId: coupon_item.productId || 0,
                        }],
                        ordertype: "0",
                        addrid: F.address_id,
                    }, createDisOrder_callback);

                }
            }

            function get_coupon_id(array) {
                for (let index = 0; index < array.length; index++) {
                    const element = array[index];
                    if (element.couponId) return element.couponId;
                }
            }

            function get_coupon_item(id, array) {
                if (id === undefined) return {};
                for (let index = 0; index < array.length; index++) {
                    const element = array[index];
                    if (element.id === id) return element;
                }
            }


            // 提交补全信息
            function userAddDetailInfo(data) {
                loading.show();
                F._userAddDetailInfo(data, function (ret) {
                    loading.hide();
                    if (!ret) return false;

                    switch (ret.code) {
                        case 10000:

                            go_next();

                            break;

                        default:
                            F._confirm('Gợi ý', 'Gửi thông tin thất bại', 'error', [{
                                name: 'Xác nhận',
                                func: function () { }
                            }]);
                            break;
                    }
                });
            }

            // 去补全信息
            function getSchoolInfo_addInfo(userInfo) {
                loading.show();
                F._getSchoolInfo({}, function (ret) {
                    loading.hide();
                    var baseinfo = new F._baseinfo(ret.details, userInfo);
                    baseinfo.show();
                    $("#submit_baseinfo").on('click', function () {
                        baseinfo.submit(function (result) {
                            baseinfo.hide();
                            userAddDetailInfo(result);
                        });
                    });
                });
            }

            // 提交订单
            function submit() {
                if (!localStorage.getItem("funId")) {
                    F._confirm('Gợi ý', 'Vui lòng đăng nhập', 'tips', [{
                        name: 'Xác nhận',
                        func: function () {
                            window.location.href = 'login.html';
                        }
                    }]);
                    return false;
                }

                if (!F.username || !F.msisdn || !F.address) {
                    F._confirm('Gợi ý', 'Vui lòng Thêm địa chỉ nhận hàng', 'tips', [{
                        name: 'Xác nhận',
                        func: function () {
                            location.href = location.href + '#';
                        }
                    }]);
                    return false;
                }

                if (!F.address && F.addrlistData.length) {
                    F._confirm('Gợi ý', 'Vui lòng chọn địa chỉ nhận hàng của bạn', 'tips', [{
                        name: 'Xác nhận',
                        func: function () {

                        }
                    }]);
                    return false;
                }

                if (!F.division2ndName) {
                    F._confirm("Gợi ý", "Địa chỉ này chưa đầy đủ, Vui lòng Sửa", "tips", [
                        {
                            name: "Xác nhận",
                            func: function () {
                            }
                        }
                    ]);
                    return false;
                }

                function get_num(array) {
                    var index;
                    var quantity = 0;
                    for (index = 0; index < array.length; index++) {
                        quantity += array[index].quantity;
                    }
                    return quantity;
                }

                F.vue.paymentNum = parseFloat(F.vue.paymentNum).toFixed(1);
                F.totalamount = parseFloat(F.totalamount);
                F.quantity = get_num(F.LS__data);

                function check_userViewDetailInfo() {
                    loading.show();
                    F._userViewDetailInfo({}, function (ret) {
                        loading.hide();
                        if (!ret) return false;

                        if (ret.status) { // 资料齐全
                            go_next();
                        } else { // 资料不全
                            F._confirm('Gợi ý', 'Bạn chưa hoàn thiện thông tin chi tiết, vui lòng hoàn thiện trước', 'tips', [{
                                name: 'Để sau',
                                func: function () { }
                            }, {
                                name: 'Hoàn thiện ngay',
                                func: function () {
                                    getSchoolInfo_addInfo(ret.data);
                                }
                            }]);
                        }
                    });
                }

                loading.show();
                if (F.vue.paymentNum === '1.0') {
                    // 全款
                    F._is_initPaypassword(function (status) {
                        loading.hide();
                        if (status === false && F.vue.payway === '1') {
                            F._confirm("Gợi ý", "Vui lòng đặt mật khẩu giao dịch", "tips", [
                                {
                                    name: "Xác nhận",
                                    func: function () {
                                        window.open('./back_id.html?from=payPwd');
                                    }
                                }
                            ]);
                            return false;
                        }
                        go_next();
                    });

                } else {
                    F._is_initPaypassword(function (status) {
                        loading.hide();
                        if (status === false && F.vue.payway === '1') {
                            F._confirm("Gợi ý", "Vui lòng đặt mật khẩu giao dịch", "tips", [
                                {
                                    name: "Xác nhận",
                                    func: function () {
                                        window.open('./back_id.html?from=payPwd');
                                    }
                                }
                            ]);
                            return false;
                        }
                        check_userViewDetailInfo();
                    });
                }

            }

            function createDisOrder_callback(ret) {
                loading.hide();

                if (!ret) return false;
                if (ret.code !== 10000) return false;
                F.orderNo = ret.orderNo;
                F.tradeNo = ret.tradeNo;

                var payway = F.vue.payway;
                function go_pay() {
                    if (payway === '1') {
                        F._payPwd_open(function (paypassword) {
                            loading.show();
                            F._payDisOrder({
                                orderno: F.orderNo,
                                tradeno: F.tradeNo,
                                payway: payway,
                                paypassword: paypassword,
                            }, paymentDisOrder_callback);
                        });
                    } else {
                        loading.show();
                        F._payDisOrder({
                            orderno: F.orderNo,
                            tradeno: F.tradeNo,
                            payway: payway,
                            paypassword: '',
                        }, paymentDisOrder_callback);
                    }
                }

                if (F.vue.paymentNum === '1.0') {
                    // 全款
                    go_pay();
                } else {
                    window.location.href = './successPay.html?type=1';
                }
            }

            function paymentDisOrder_callback(ret) {
                loading.hide();
                if (!ret) return false;
                if (ret.code !== 10000) return false;

                window.location.href = './successPay.html?type=2';
            }

            F.loadData(function () {
                load();
            });
        })
    </script>
    <!-- <script src="https://s22.cnzz.com/z_stat.php?id=1271691056&web_id=1271691056" language="JavaScript"></script> -->
    <!-- Facebook Pixel Code -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window,document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '451017758654222'); 
        fbq('track', 'PageView');
    </script>
    <noscript>
        <img height="1" width="1" src="https://www.facebook.com/tr?id=451017758654222&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Facebook Pixel Code -->
</body>

</html>