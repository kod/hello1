<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-param" content="_csrf-frontend">
    <meta name="csrf-token" content="9KbQKGBaz3NrMQ3liXwYWk6WkgEf5raA6c-6coqnME3PMcFVP092_qbGqN2tYGypDTzSB-2Zhr074Le4DZpLng==">
    <link rel='icon' href='../img/icon.png' type='image/x-ico' />
    <link href="../css/jquery-accordion-menu.css?version=2.5.5-alpha" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="../css/base.css?version=2.5.5-alpha">
    <title>Tình trạng cụ thể đơn hàng</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-112306571-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-112306571-1');
    </script>
    <script src="../js/jquery.js?version=2.5.5-alpha"></script>
    <script src="../js/jquery-accordion-menu.js?version=2.5.5-alpha" type="text/javascript"></script>
    <script src="../js/md5.js?version=2.5.5-alpha"></script>
    <script src="../js/require2.3.5.min.js?version=2.5.5-alpha"></script>
    <style>
        .body {
            border-top: 1px solid #72aef0;
        }

        .body__main-time {
            line-height: 45px;
            color: #888;
            border-bottom: 1px solid #d9d9d9;
            padding-bottom: 10px;
            margin-top: 10px;
            margin-bottom: 40px;
        }

        .body__main-time:after {
            display: block;
            content: "";
            clear: both;
            height: 0;
        }

        .body__m-t-left {
            float: left;
            width: 800px;
        }

        .body__m-t-right {
            float: left;
            width: 400px;
            text-align: right;
            font-size: 16px;
            color: #333;
        }

        .body__m-t-order {
            margin-left: 15px;
            padding-left: 18px;
            border-left: 1px solid #d9d9d9;
        }

        .body__main-info {
            margin-bottom: 60px;
            padding-left: 35px;
        }

        .body__m-i-top {
            margin-bottom: 25px;
        }

        .body__m-i-t-name {
            margin-right: 25px;
        }

        .body__main-phone {
            margin-bottom: 70px;
        }

        .body__m-i-t-title {
            color: #888;
            margin-right: 10px;
        }

        .body__m-p-title {
            text-align: center;
            font-size: 0;
            line-height: 32px;
            color: #888;
            margin-bottom: 10px;
        }

        .body__m-p-t-info {
            width: 590px;
            font-size: 14px;
            border-bottom: 5px solid #add4fb;
        }

        .body__m-p-t-num {
            width: 125px;
            font-size: 14px;
            margin-left: 25px;
            border-bottom: 5px solid #add4fb;
        }

        .body__m-p-t-price {
            width: 205px;
            margin-left: 25px;
            font-size: 14px;
            border-bottom: 5px solid #add4fb;
        }

        .body__m-p-t-subtotal {
            width: 205px;
            margin-left: 25px;
            font-size: 14px;
            border-bottom: 5px solid #add4fb;
        }

        .body__m-p-main {
            font-size: 0;
        }

        .body__m-p-m-info {
            display: inline-block;
            width: 590px;
            font-size: 14px;
            cursor: pointer;
        }

        .body__m-p-m-info:after {
            display: block;
            content: "";
            clear: both;
            height: 0;
        }

        .body__m-p-m-num {
            width: 125px;
            font-size: 14px;
            text-align: center;
            margin-left: 25px;
            margin-top: 35px;
        }

        .body__m-p-m-price {
            width: 205px;
            margin-left: 25px;
            font-size: 14px;
            text-align: center;
            margin-top: 35px;
        }

        .body__m-p-m-subtotal {
            width: 205px;
            margin-left: 25px;
            font-size: 14px;
            text-align: center;
            margin-top: 35px;
        }

        .body__m-p-m-info {
            font-size: 0px;
        }

        .body__m-p-m-i-img {
            float: left;
            width: 100px;
            height: 100px;
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover;
            border-radius: 3px;
        }

        .body__m-p-m-i-text {
            float: left;
            width: 470px;
            font-size: 14px;
            margin-top: 30px;
            line-height: 1.5;

            display: -webkit-box;
            overflow: hidden;
            text-overflow: ellipsis;
            word-wrap: break-word;
            white-space: normal !important;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .body__main-pay {
            padding-left: 35px;
            margin-bottom: 80px;
        }

        .body__m-p-text {
            color: #888;
            margin-bottom: 15px;
        }

        .body__main-button {
            padding-left: 130px;
            margin-bottom: 50px;
        }

        .body__main-left {
            height: 45px;
            line-height: 45px;
            width: 280px;
            text-align: center;
            background-color: #147af3;
            color: #fff;
            border-radius: 3px;
            cursor: pointer;
        }

        .body__main-left:hover {
            background-color: #045ac3;
        }

        .body__main-operate {
            margin-bottom: 50px;
            text-align: right;
            margin-left: 15px;
        }

        .body__m-o-left {
            line-height: 45px;
            width: 200px;
            background-color: #ddd;
            color: #666;
            text-align: center;
            cursor: pointer;
        }

        .body__m-o-left:hover {
            background-color: #ccc;
        }

        .body__m-o-right {
            line-height: 45px;
            width: 200px;
            background-color: #147af3;
            color: #fff;
            border-radius: 3px;
            text-align: center;
            margin-left: 15px;
            cursor: pointer;
        }

        .body__m-o-right:hover {
            background-color: #045ad3;
        }

        .body__main-fristpay {
            text-align: right;
            margin-bottom: 20px;
            line-height: 30px;
            font-weight: 700;
        }

        .body__main-f-label {
            margin-top: -2px;
            padding-right: 4px;
            font-size: 16px;
        }

        .body__m-f-unit {
            color: #F7004C;
            margin-top: -2px;
        }

        .body__m-f-text {
            color: #999;
            padding-right: 10px;
        }

        .body__m-f-price {
            font-size: 24px;
            color: #F7004C;
            margin-top: -3px;
        }

        textarea {
            width: 270px;
            height: 150px;
            margin-left: 14px;
            outline: none;
            resize: none;
            border: 1px solid #ddd;
            color: #999;
            overflow-x: hidden;
            padding: 15px;
        }

        .return-money {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, .3);
            z-index: 1234;
            padding-top: 10%;
        }

        .return-money__main {
            width: 690px;
            margin: 0 auto;
        }

        .return-money__main:after {
            display: block;
            content: "";
            clear: both;
            height: 0;
        }

        .return-money__main-title {
            background-color: #f2f2f2;
            padding: 15px;
        }

        .return-money__m-t-left {
            font-size: 18px;
            color: #333;
            font-weight: bold;
        }

        .return-money__m-t-right {
            text-align: right;
        }

        .return-money__m-t-r-close {
            height: 25px;
            width: 25px;
            cursor: pointer;
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            background-image: url(../img/close.png);
        }

        .return-money__main-contetn {
            background-color: #fff;
            text-align: center;
            padding: 30px 0;
            font-size: 13px;
            color: #555;
        }

        .return-money__m-c-title {
            margin-bottom: 10px;
        }

        .return-money__m-c-item {
            padding: 3px 0;
        }

        .return-money__m-c-i-row1 {
            float: left;
            width: 20%;
        }

        .return-money__m-c-i-row2 {
            float: left;
            width: 40%;
        }

        .return-money__m-c-i-row3 {
            float: left;
            width: 40%;
        }
    </style>
</head>

<body>
    <div class="content" id="vue-el">
        <div class="return-money" v-show="SH__returnMoney" style="display: none;" @click="SH__returnMoney = false">
            <div class="return-money__main">
                <div class="return-money__main-title col-xs-24">
                    <div class="return-money__m-t-left col-xs-12">Thông tin về số tiền trả góp</div>
                    <div class="return-money__m-t-right col-xs-12">
                        <span class="return-money__m-t-r-close" @click="SH__returnMoney = false"></span>
                    </div>
                </div>
                <div class="return-money__main-contetn col-xs-24">
                    <div class="return-money__m-c-title col-xs-24">
                        <div class="return-money__m-c-i-row1">Hóa đơn</div>
                        <div class="return-money__m-c-i-row2">Số tiền phải trả hàng tháng</div>
                        <div class="return-money__m-c-i-row3">Phí dịch vụ hàng tháng</div>
                    </div>
                    <div class="return-money__m-c-item col-xs-24" v-for="(val, key) in returnMoney">
                        <div class="return-money__m-c-i-row1">{{ key + 1 }} Số kỳ</div>
                        <div class="return-money__m-c-i-row2">{{ priceFormat(val.principal) }} VND</div>
                        <div class="return-money__m-c-i-row3">{{ priceFormat(val.interest) }} VND</div>
                    </div>
                </div>
            </div>
        </div>
        <header class="header" id="header"></header>
        <section class="body">
            <div class="body__main" :style="{ 'min-height': body__main_height + 'px' }">
                <div class="body__main-time">
                    <div class="body__m-t-left">
                        <span class="body__m-t-time" v-html="'Thời gian đặt hàng: '+ createTime"></span>
                        <span class="body__m-t-order" v-html="'Mã đơn hàng: ' + orderNo"></span>
                    </div>
                    <div class="body__m-t-right">
                        <span class="body__m-t-r-status" v-html="gettradeStatus(tradeStatus)"></span>
                    </div>
                </div>
                <div class="bar-title">
                    <div class="bar-title__main">
                        <span class="bar-title__main-text">Thông tin người nhận hàng</span>
                    </div>
                </div>
                <div class="body__main-info">
                    <div class="body__m-i-top">
                        <!-- <span class="body__m-i-t-name" v-html="'Người nhận hàng: ' + username"></span> -->
                        <span class="body__m-i-t-title">Điện thoại:</span>
                        <span class="body__m-i-t-phone" v-html="msisdn"></span>
                    </div>
                    <div class="body__m-i-top">
                        <span class="body__m-i-t-title">Người nhận hàng:</span>
                        <span class="body__m-i-t-name" v-html="username"></span>
                        <!-- <span class="body__m-i-t-phone" v-html="'Điện thoại: ' + msisdn"></span> -->
                    </div>
                    <div class="body__m-i-bottom">
                        <span class="body__m-i-t-title">Địa chỉ nhận hàng: </span>
                        <span class="body__m-i-t-address" v-html="address"></span>
                    </div>
                </div>
                <div class="body__main-phone">
                    <div class="body__m-p-title">
                        <span class="body__m-p-t-info">Thông tin về sản phẩm</span>
                        <span class="body__m-p-t-num">Số lượng</span>
                        <span class="body__m-p-t-price">Giá sản phẩm</span>
                        <span class="body__m-p-t-subtotal">Tổng cộng</span>
                    </div>
                    <div class="body__m-p-main" v-for="(val, key) in goodsDetail">
                        <div class="body__m-p-m-info" @click="openProduct(val.typeId, val.brandId)">
                            <div class="body__m-p-m-i-img" :style="{ 'background-image': 'url(' + val.iconUrl + ')' }"></div>
                            <div class="body__m-p-m-i-text" v-html="val.name"></div>
                        </div>
                        <span class="body__m-p-m-num" v-html="val.number"></span>
                        <span class="body__m-p-m-price" v-html="priceFormat(val.totalAmount)"></span>
                        <span class="body__m-p-m-subtotal" v-html="priceFormat(val.totalAmount * val.number)"></span>
                    </div>
                </div>
                <!-- <div class="bar-title">
                    <div class="bar-title__main">
                        <span class="bar-title__main-text">Thanh toán</span>
                    </div>
                </div> -->
                <div class="body__m-i-top">
                    <div class="body__m-i-t-name" v-html="'Số kỳ thanh toán:&nbsp;&nbsp;&nbsp;&nbsp;' + (repaymentMonth === 0 ? 'Trả toàn bộ' : repaymentMonth + ' Tháng')"></div>
                </div>
                <div class="body__m-i-top">
                    <div class="body__m-i-t-name" v-html="'Tỉ lệ thanh toán lần đầu :&nbsp;&nbsp;&nbsp;&nbsp;' + (payRate === 1 ? 'Trả toàn bộ' : payRate * 100 + '%')"></div>
                </div>
                <div class="" style="display: none" v-show="tradeStatus === '10000'">
                    <div class="bar-title">
                        <div class="bar-title__main">
                            <span class="bar-title__main-text">Phương thức thanh toán</span>
                        </div>
                    </div>
                    <div class="body__main-pay">
                        <!-- <div class="body__m-p-text">Phương thức thanh toán: </div> -->
                        <!-- <div class="payway__main-bottom">
                            <div class="payway__m-b-item" @click="balance_pay = false" :class="{ 'payway__m-b-item_acitve': !balance_pay }">
                                <span class="payway__m-b-i-icon1" style="background-image: url(../img/bank01.png);"></span>
                                <span class="payway__m-b-i-icon2" style="background-image: url(../img/bank02.png);"></span>
                                <span class="payway__m-b-i-text">Ngân hàng</span>
                            </div>
                            <div class="payway__m-b-item" @click="balance_pay = true" :class="{ 'payway__m-b-item_acitve': balance_pay }">
                                <span class="payway__m-b-i-icon1" style="background-image: url(../img/bank01.png);"></span>
                                <span class="payway__m-b-i-icon2" style="background-image: url(../img/bank02.png);"></span>
                                <span class="payway__m-b-i-text">Số dư</span>
                            </div>
                        </div> -->
                        <div class="payway__main-bottom" id="payway__main-bottom">
                            <!-- <div class="payway__m-b-item" @click="payway = '3'" :class="{ 'payway__m-b-item_acitve': payway === '3' }">
                                <div class="payway__m-b-i-text">napas</div>
                                <div class="payway__m-b-i-icon">
                                    <span class="payway__m-b-i-icon-img" style="background-image: url(../img/pay_napas.png);"></span>
                                </div>
                                <div class="payway__m-b-i-indicator">
                                    <span class="payway__m-b-i-i-img"></span>
                                </div>
                            </div> -->
                            <div class="payway__m-b-item" @click="payway = '2'" :class="{ 'payway__m-b-item_acitve': payway === '2' }">
                                <div class="payway__m-b-i-text">Ngân hàng</div>
                                <div class="payway__m-b-i-icon">
                                    <span class="payway__m-b-i-icon-img" style="background-image: url(../img/pay_epay.png);"></span>
                                </div>
                                <div class="payway__m-b-i-indicator">
                                    <span class="payway__m-b-i-i-img"></span>
                                </div>
                            </div>
                            <div class="payway__m-b-item" @click="payway = '1'" :class="{ 'payway__m-b-item_acitve': payway === '1' }">
                                <div class="payway__m-b-i-text">Số dư</div>
                                <div class="payway__m-b-i-icon">
                                    <span class="payway__m-b-i-icon-img" style="background-image: url(../img/pay_balance.png);"></span>
                                </div>
                                <div class="payway__m-b-i-indicator">
                                    <span class="payway__m-b-i-i-img"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="body__main-fristpay" style="display: none" v-show="tradeStatus === '10000'">
                    <div class="body__m-f-text" v-if="payRate === 1">
                        <span class="body__main-f-label">Tổng tiền: </span>
                        <span class="body__m-f-price" v-html="priceFormat(advance)"></span>
                        <span class="body__m-f-unit">VND</span>
                        <!-- <img src="../img/titi.png" @click="information" style="width:15px;height:15px;margin-top:7px;margin-left: 5px;cursor:pointer;"> -->
                    </div>
                    <div class="body__m-f-text" v-if="payRate !== 1">
                        <span class="body__main-f-label">Trả góp hàng tháng: </span>
                        <span class="body__m-f-price" v-html="priceFormat(preReturnMoney)"></span>
                        <span class="body__m-f-unit" v-html="'VND x ' + repaymentMonth"></span>
                        <img src="../img/titi.png" @click="information" style="width:15px;height:15px;margin-top:5px;margin-left: 5px;cursor:pointer;">
                    </div>
                </div>
                <div class="body__main-operate">
                    <span class="body__m-o-left" @click="operate_left()" v-html="operate_left_text[tradeStatus]" v-if="repaymentMonth === 0"></span>
                    <span class="body__m-o-right" @click="operate_rihgt()" v-html="operate_right_text[tradeStatus]"></span>
                </div>
            </div>
        </section>
        <footer class="footer" id="footer"></footer>
    </div>
    <script>
        require([
            // '../js/jquery1.11.2.js?version=2.5.5-alpha',
            '../js/vue.min.js?version=2.5.5-alpha',
            '../js/md5.js?version=2.5.5-alpha',
            '../js/common.js?version=2.5.5-alpha',
        ], function (Vue, md5) {

            var loading = new F._loading();

            F.query = F._hrefUtils.parse().query;

            F.vue = {
                body__main_height: document.documentElement.clientHeight - 133 - 210,
                balance_pay: false, // 是否用余额支付
                payway: '2',
                operate_right_text: {
                    '10000': 'Thanh toán',
                    'TRADE_CLOSED': '',
                    'TRADE_SUCCESS': '',
                    'TRADE_FINISHED': '',
                    'TRADE_REJECT': '',
                    'TRADE_PAY_FAIL': '',
                    'WAIT_SHIPMENTS': '',
                    'SUCCESS_SHIPPED_NOT': 'Đánh giá',
                    'SUCCESS_SHIPPED_YES': '',
                },
                operate_left_text: {
                    '10000': 'Hủy',
                    'TRADE_CLOSED': '',
                    'TRADE_SUCCESS': '',
                    'TRADE_FINISHED': '',
                    'TRADE_REJECT': '',
                    'TRADE_PAY_FAIL': '',
                    'WAIT_SHIPMENTS': '',
                    'SUCCESS_SHIPPED_NOT': '',
                    'SUCCESS_SHIPPED_YES': '',
                },
                SH__returnMoney: false,
                returnMoney: [],
            };

            var load = function () {
                new_vue();
            };

            var pre_data = function (data) {

                function edit_address(address, division4thName, division3rdName, division2ndName) {
                    return address + (division4thName ? ', ' : '') + division4thName + (division3rdName ? ', ' : '') + division3rdName + (division2ndName ? ', ' : '') + division2ndName;
                }

                var trade_queryOrder = data._trade_queryOrder;
                var returnMoney = data._returnMoney;

                F.vue.orgAmount = trade_queryOrder.orgAmount;
                F.vue.totalAmount = trade_queryOrder.totalAmount;
                F.vue.payRate = trade_queryOrder.payRate;
                F.vue.repaymentMonth = trade_queryOrder.repaymentMonth;
                F.vue.orderNo = trade_queryOrder.orderNo;
                F.vue.createTime = trade_queryOrder.createTime;
                F.vue.msisdn = trade_queryOrder.msisdn;
                F.vue.username = trade_queryOrder.username;
                F.vue.address = edit_address(trade_queryOrder.address, trade_queryOrder.division4thName, trade_queryOrder.division3rdName, trade_queryOrder.division2ndName);
                F.vue.division4thName = trade_queryOrder.division4thName;
                F.vue.division3rdName = trade_queryOrder.division3rdName;
                F.vue.division2ndName = trade_queryOrder.division2ndName;
                F.vue.tradeStatus = trade_queryOrder.tradeStatus;
                F.vue.advance = trade_queryOrder.advance;
                F.vue.sourceOrderType = trade_queryOrder.sourceOrderType;
                F.vue.goodsDetail = edit_goodsDetail(trade_queryOrder.goodsDetail);

                F.vue.returnMoney = returnMoney.details[F.vue.orgAmount + '_' + F.vue.repaymentMonth + '_' + F.vue.payRate];
                F.vue.preReturnMoney = F.vue.repaymentMonth === 0 ? 0 : F.vue.returnMoney[0].interest + F.vue.returnMoney[0].principal;

            }

            F.loadData = function (params, callback) {
                if (callback === undefined) callback = params;

                var all_data = {};
                var request_length = 2; //请求个数

                // 请求是否全部返回
                function all_loaded() {
                    if (Object.keys(all_data).length === request_length) {
                        pre_data(all_data);
                        loading.hide();
                        callback(all_data);
                    }
                }
                loading.show();

                loadData_trade_queryOrder(function (ret) {

                    loadData_returnMoney(ret, function (ret) {
                        all_data._returnMoney = ret;
                        all_loaded();
                    });

                    all_data._trade_queryOrder = ret;
                    all_loaded();
                });

            };

            function new_vue() {
                F.vue = new Vue({
                    el: $('#vue-el')[0],
                    data: F.vue,
                    methods: {
                        operate_rihgt: operate_rihgt,
                        operate_left: operate_left,
                        openProduct: openProduct,
                        information: information,
                        priceFormat: F._priceFormat,
                        gettradeStatus: F._tradeStatus,
                    },
                    computed: {

                    },
                });
            }

            function loadData_trade_queryOrder(callback) {
                F._queryOrder({
                    orderNo: F.query.orderNo,
                    tradeNo: F.query.tradeNo,
                }, function (ret) {
                    if (!ret) return false;
                    if (ret.code !== 10000) return false;
                    callback(ret);
                });
            }

            function loadData_returnMoney(params, callback) {
                F._returnMoney({
                    totalamounts: params.orgAmount,
                    repaymentmonths: params.repaymentMonth,
                    payrate: params.payRate,
                }, function (ret) {
                    if (!ret) return false;
                    if (ret.code !== 10000) return false;
                    callback(ret);
                });
            }

            function edit_goodsDetail(array) {
                // var index;
                // for (index = 0; index < array.length; index++) {
                //     if (!array[index].price) {
                //         array[index].price = array[index].totalAmount;
                //     }
                // }
                return array;
            }

            function operate_rihgt() {
                if (F.vue.tradeStatus === '10000') {

                    F._is_initPaypassword(function (status) {
                        if (status === false && F.vue.payway === '1') {
                            F._confirm("Gợi ý", "Vui lòng đặt mật khẩu giao dịch", "tips", [
                                {
                                    name: "Xác nhận",
                                    func: function () {
                                        window.open('./back_id.html?from=payPwd');
                                    }
                                }
                            ]);
                            return false;
                        }

                        order_pay({
                            totalAmount: F.vue.totalAmount,
                            tradeNo: F.query.tradeNo,
                            orderNo: F.query.orderNo,
                            advance: F.vue.advance,
                            payRate: F.vue.payRate,
                            repaymentMonth: F.vue.repaymentMonth,
                            prepay: F.vue.advance,
                            payway: F.vue.payway,
                        });
                    });
                }
            }

            function operate_left() {
                if (F.vue.tradeStatus === '10000') {
                    F._confirm('Gợi ý', 'Xác nhận？', 'tips', [{
                        name: 'Hủy',
                        func: function () {

                        }
                    }, {
                        name: 'Xác nhận',
                        func: function () {
                            var loading = new F._loading();
                            F._order_cancel(function (code) {
                                if (!code) return false;

                                loading.show();
                                F._orderCancel({
                                    orderNo: F.query.orderNo,
                                    tradeNo: F.query.tradeNo,
                                    status: code,
                                }, function (ret) {
                                    loading.hide();
                                    if (!ret) return false;
                                    if (ret.code !== 10000) return false;

                                    window.location.reload();
                                });
                            });
                        }
                    }]);

                }
            }

            // 支付订单
            function order_pay(params, callback) {
                function normalOrder(params) {
                    if (F.vue.repaymentMonth === 0) { //全额

                        if (params.payway === '1') {
                            F._payPwd_open(function (paypassword) {
                                loading.show();
                                F._payDisOrder({
                                    orderno: params.orderNo,
                                    tradeno: params.tradeNo,
                                    payway: params.payway,
                                    paypassword: paypassword,
                                    _noConfirm: true,
                                }, payOrder_callback);
                            });
                        } else {
                            loading.show();
                            F._payDisOrder({
                                orderno: params.orderNo,
                                tradeno: params.tradeNo,
                                // advance: params.advance,
                                payway: params.payway,
                                paypassword: '',
                                _noConfirm: true,
                            }, payOrder_callback);
                        }

                    } else {
                        loading.show();
                        F._userViewDetailInfo({}, function (ret) {
                            loading.hide();
                            if (!ret) return false;

                            if (ret.status) { // 资料齐全

                                if (params.payway === '1') {
                                    F._payPwd_open(function (paypassword) {

                                        loading.show();
                                        F._payDisOrder({
                                            orderno: params.orderNo,
                                            tradeno: params.tradeNo,
                                            payway: params.payway,
                                            paypassword: paypassword,
                                            _noConfirm: true,
                                        }, payOrder_callback);

                                    });
                                } else {
                                    F._payDisOrder({
                                        orderno: params.orderNo,
                                        tradeno: params.tradeNo,
                                        payway: params.payway,
                                        paypassword: '',
                                        _noConfirm: true,
                                    }, payOrder_callback);

                                }

                            } else { // 资料不全
                                F._confirm('Gợi ý', 'Bạn chưa hoàn thiện thông tin chi tiết, vui lòng hoàn thiện trước', 'tips', [{
                                    name: 'Để sau',
                                    func: function () { }
                                }, {
                                    name: 'Hoàn thiện ngay',
                                    func: function () {
                                        getSchoolInfo_addInfo(ret.data);
                                    }
                                }]);
                            }
                        });
                    }
                }

                // function cart_order(params) {
                //     if (params.payway === '1') {
                //         F._payPwd_open(function (paypassword) {
                //             loading.show();
                //             F._payDisOrder({
                //                 orderno: params.orderNo,
                //                 tradeno: params.tradeNo,
                //                 payway: params.payway,
                //                 paypassword: paypassword,
                //             }, payOrder_callback);
                //         });
                //     } else {
                //         F._payDisOrder({
                //             orderno: params.orderNo,
                //             tradeno: params.tradeNo,
                //             payway: params.payway,
                //             paypassword: '',
                //         }, payOrder_callback);
                //     }
                // }

                normalOrder(params);

                // switch (F.vue.sourceOrderType) {
                //     case 0: // 普通订单
                //         normalOrder(params);
                //         break;

                //     case 1: // 购物车订单
                //         cart_order(params);
                //         break;

                //     default:
                //         break;
                // }

            }

            function userAddDetailInfo(data) {
                var loading = new F._loading();
                loading.show();
                F._userAddDetailInfo(data, function (ret) {
                    loading.hide();
                    if (!ret) return false;

                    switch (ret.code) {
                        case 10000:
                            order_pay({
                                totalAmount: F.vue.totalAmount,
                                tradeNo: F.query.tradeNo,
                                orderNo: F.query.orderNo,
                                advance: F.vue.advance,
                                payRate: F.vue.payRate,
                                repaymentMonth: F.vue.repaymentMonth,
                                prepay: F.vue.advance,
                                payway: F.vue.payway,
                            });
                            break;

                        default:
                            F._confirm('Gợi ý', 'Gửi thông tin thất bại', 'error', [{
                                name: 'Xác nhận',
                                func: function () { }
                            }]);
                            break;
                    }
                });
            }

            function getSchoolInfo_addInfo(userInfo) {

                var loading = new F._loading();
                loading.show();
                F._getSchoolInfo({}, function (ret) {
                    loading.hide();
                    var baseinfo = new F._baseinfo(ret.details, userInfo);
                    baseinfo.show();
                    $("#submit_baseinfo").on('click', function () {
                        baseinfo.submit(function (result) {
                            baseinfo.hide();
                            userAddDetailInfo(result);
                        });
                    });
                });
            }

            function information() {
                F.vue.SH__returnMoney = true;

                // loading.show();
                // F._returnMoney({
                //     totalamounts: F.vue.orgAmount,
                //     repaymentmonths: F.vue.repaymentMonth,
                //     payrate: F.vue.payRate,
                // }, function (ret) {
                //     loading.hide();
                //     if (!ret) return false;
                //     if (ret.code !== 10000) return false;
                //     F.vue.returnMoney = ret.details[F.vue.orgAmount + '_' + F.vue.repaymentMonth + '_' + F.vue.payRate];
                //     F.vue.SH__returnMoney = true;
                // });

            }

            function batchPayment_callback(ret) {
                loading.hide();
                if (!ret) return false;
                if (ret.code !== 10000) return false;

                window.location.href = './successPay.html';
            }

            function orderFullPay_callback(ret) {
                loading.hide();
                if (!ret) return false;
                if (ret.code !== 10000) return false;

                window.location.href = './successPay.html';
            }

            function payOrder_callback(ret) {
                loading.hide();
                if (!ret) return false;
                if (ret.code !== 10000) return false;

                window.location.href = './successPay.html';
            }

            function openProduct(typeId, brandId) {
                // var typeId = F.query.typeId;
                // var brandId = F.query.brandId;
                window.location.href = "./details.html?typeId=" + typeId + "&brandId=" + brandId;
            }

            F.loadData(function () {
                load();
            });
        });
    </script>
    <script src="https://s22.cnzz.com/z_stat.php?id=1271691056&web_id=1271691056" language="JavaScript"></script>
</body>

</html>